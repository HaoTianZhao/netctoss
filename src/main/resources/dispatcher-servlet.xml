<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <!--与application配合，只扫描controller-->
    <context:component-scan base-package="com.barista">
        <context:include-filter type="annotation"
                                expression="org.springframework.stereotype.Controller"/>
    </context:component-scan>

    <!--配置springMVC注解驱动-->
    <mvc:annotation-driven>
        <!--添加数据转换的注解驱动 -->
        <mvc:message-converters>
            <ref bean="fastJsonConfig"/>
        </mvc:message-converters>
    </mvc:annotation-driven>

    <!--fastJson配置准入MediaType-->
    <bean id="fastJsonConfig"
          class="com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter">
        <property name="supportedMediaTypes">
            <list>
                <value>application/json;charset=UTF-8</value>
                <!--<value>application/json</value>-->
                <!--<value>application/atom+xml</value>-->
                <!--<value>application/x-www-form-urlencoded</value>-->
                <!--<value>application/octet-stream</value>-->
                <!--<value>application/pdf</value>-->
                <!--<value>application/rss+xml</value>-->
                <!--<value>application/xhtml+xml</value>-->
                <!--<value>application/xml</value>-->
                <!--<value>image/gif</value>-->
                <!--<value>image/jpeg</value>-->
                <!--<value>image/png</value>-->
                <!--<value>text/event-stream</value>-->
                <value>text/html;charset=UTF-8</value>
                <!--<value>text/markdown</value>-->
                <!--<value>text/plain</value>-->
                <!--<value>text/xml</value>-->
            </list>
        </property>
    </bean>

    <!-- 上传组件 -->
    <bean id="multipartResolver"
          class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <!-- 设置上传的编码格式 -->
        <property name="defaultEncoding" value="utf-8"/>
        <!-- 设置最大上传大小 5M-->
        <property name="maxUploadSize" value="5242880"/>
    </bean>

    <!--视图解析器-->
    <!--<bean id="viewResolver"-->
    <!--class="org.springframework.web.servlet.view.InternalResourceViewResolver">-->
    <!--<property name="prefix" value="/"/>-->
    <!--<property name="suffix" value=".html"/>-->
    <!--</bean>-->

    <!--转换器-->
    <!--<bean id="dateConvert"-->
    <!--class="org.springframework.format.support.FormattingConversionServiceFactoryBean">-->
    <!--<property name="converters">-->
    <!--<set>-->
    <!--<bean class="com.barista.convert.DateConvert"/>-->
    <!--</set>-->
    <!--</property>-->
    <!--</bean>-->
    <!--<mvc:annotation-driven conversion-service="dateConvert"/>-->

    <!--配置静态资源放行：除了控制器一概不管理-->
    <mvc:default-servlet-handler/>

    <mvc:resources mapping="/page/**" location="/page/"/>

    <!--配置拦截器-->
    <mvc:interceptors>
        <mvc:interceptor>
            <mvc:mapping path="/**"/>
            <!--登录，登出和获取验证码放行-->
            <mvc:exclude-mapping path="/static/**"/>
            <mvc:exclude-mapping path="/login"/>
            <mvc:exclude-mapping path="/logout"/>
            <mvc:exclude-mapping path="/page/login.html"/>

            <!--静态资源放行-->
            <mvc:exclude-mapping path="/favicon.ico"/>
            <mvc:exclude-mapping path="/page/images/**"/>
            <mvc:exclude-mapping path="/page/js/**"/>
            <mvc:exclude-mapping path="/page/styles/**"/>
            <bean class="com.barista.interceptor.LoginInterceptor"/>
        </mvc:interceptor>


        <mvc:interceptor>
            <mvc:mapping path="/**"/>
            <!--获取验证码，登录，登出，首页，放行-->
            <mvc:exclude-mapping path="/static/**"/>
            <mvc:exclude-mapping path="/login"/>
            <mvc:exclude-mapping path="/logout"/>
            <mvc:exclude-mapping path="/page/login.html"/>

            <!--首页，个人信息修改和修改个人密码放行-->
            <mvc:exclude-mapping path="/page/index.html"/>
            <mvc:exclude-mapping path="/page/user/**"/>
            <mvc:exclude-mapping path="/admin/getAdminInfo"/>
            <mvc:exclude-mapping path="/admin/updateAdminInfo"/>
            <mvc:exclude-mapping path="/admin/changePassword"/>

            <!--静态资源放行-->
            <mvc:exclude-mapping path="/favicon.ico"/>
            <mvc:exclude-mapping path="/page/component/**"/>
            <mvc:exclude-mapping path="/page/images/**"/>
            <mvc:exclude-mapping path="/page/js/**"/>
            <mvc:exclude-mapping path="/page/styles/**"/>

            <!--错误界面放行-->
            <mvc:exclude-mapping path="/page/error.html"/>
            <mvc:exclude-mapping path="/page/nopower.html"/>
            <bean class="com.barista.interceptor.AuthorityInterceptor"/>
        </mvc:interceptor>
    </mvc:interceptors>

</beans>